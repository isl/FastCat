!function e(r,t,n){function o(c,a){if(!t[c]){if(!r[c]){var u="function"==typeof require&&require;if(!a&&u)return u(c,!0);if(i)return i(c,!0);var l=new Error("Cannot find module '"+c+"'");throw l.code="MODULE_NOT_FOUND",l}var s=t[c]={exports:{}};r[c][0].call(s.exports,function(e){var t=r[c][1][e];return o(t?t:e)},s,s.exports,e,r,t,n)}return t[c].exports}for(var i="function"==typeof require&&require,c=0;c<n.length;c++)o(n[c]);return o}({1:[function(e,r,t){r.exports=function(e){function r(r,t){r=parseInt(r,10)||0,t=parseInt(t,10),t!==t||r>=t?t=(r||1)<<1:t+=1,e&&t>e&&(r=e>>1,t=e);var n=Math.random(),o=t-r;return~~(o*n+r)}function t(e){var t=0;return e||(t=2e3),r(e,t)}return null==e&&(e=6e5),t}},{}],2:[function(e,r,t){"use strict";function n(e){if(e=Array.prototype.slice.call(e),e.length&&"function"==typeof e[e.length-1]){var r=e.pop();return{args:e,cb:r}}return{args:e,cb:null}}function o(e,r){e.then(function(e){return r(null,e),Promise.resolve(e)},function(e){return r(e,null),Promise.reject(e)})}var i=e("./listener"),c=e("./backoff"),a=r.exports=function(e,r){function t(){function r(r){n[r]=function(){return e[r].apply(e,arguments)}}for(var t in e)"_"===t.charAt(0)||"function"!=typeof e[t]||n[t]||r(t)}var n=this;if("object"!=typeof e||!e.constructor)throw new TypeError("[PouchMirror] localDB must be an instance of PouchDB");n._localDB=e;var o=n._pouch=e.constructor;if("string"==typeof r)n._remoteDB=new o(r);else{if(!(r instanceof o))throw new TypeError("remote must be a URL string or instance of PouchDB");n._remoteDB=r}t(),n._initState()};a.prototype._initState=function(){var e=this;e._readDB=e._remoteDB,e._remoteSynced=!1,e._active=!1},a.prototype.start=function(e){var r=this;if(e||(e={}),e.live=!0,e.retry&&"function"!=typeof e.back_off_function){var t=new c(e.maxTimeout);e.back_off_function=t,r._defaultBackoff=t}if(r._active)throw new Error("[PouchMirror] Error: replication already active");r._active=!0,r._listener=new i(r._localDB);var n=r._localDB.replicate.from(r._remoteDB,e).on("paused",function(e){e||r._remoteSynced||(r._remoteSynced=!0,r._readDB=r._localDB,n.emit("up-to-date",{db:r._localDB._db_name}))}).on("error",function(e){r._listener.cancel(),r._initState(),console.error("[PouchMirror] Fatal replication error",e)});return n._superCancel=n.cancel,n.cancel=function(){r._listener.cancel(),n._superCancel(),r._initState()},r._replicator=n,n},a.prototype.pause=function(){var e=this;e._replicator.cancel()},a.prototype.get=function(){var e=this;return e._readDB.get.apply(e._readDB,arguments)},a.prototype.allDocs=function(){var e=this;return e._readDB.allDocs.apply(e._readDB,arguments)},a.prototype.bulkGet=function(){var e=this;return e._readDB.bulkGet.apply(e._readDB,arguments)},a.prototype.put=function(){var e,r=this,t=n(arguments),i=r._remoteDB.put.apply(r._remoteDB,t.args).then(function(t){return e=t,r._active?r._listener.waitForChange(t.rev):Promise.resolve()}).then(function(){return Promise.resolve(e)});return t.cb&&o(i,t.cb),i},a.prototype.post=function(){var e,r=this,t=n(arguments),i=r._remoteDB.post.apply(r._remoteDB,t.args).then(function(t){return e=t,r._active?r._listener.waitForChange(t.rev):Promise.resolve()}).then(function(){return Promise.resolve(e)});return t.cb&&o(i,t.cb),i},a.prototype.bulkDocs=function(){var e,r=this,t=n(arguments),i=r._remoteDB.bulkDocs.apply(r._remoteDB,t.args).then(function(t){e=t;var n=[];return t.forEach(function(e){e.ok===!0&&n.push(r._listener.waitForChange(e.rev))}),r._active?Promise.all(n):Promise.resolve()}).then(function(){return Promise.resolve(e)});return t.cb&&o(i,t.cb),i},a.prototype.remove=function(){var e,r=this,t=n(arguments),i=r._remoteDB.remove.apply(r._remoteDB,t.args).then(function(t){return e=t,r._active?r._listener.waitForChange(t.rev):Promise.resolve()}).then(function(){return Promise.resolve(e)});return t.cb&&o(i,t.cb),i},a.prototype.putAttachment=function(){var e,r=this,t=n(arguments),i=r._remoteDB.putAttachment.apply(r._remoteDB,t.args).then(function(t){return e=t,r._active?r._listener.waitForChange(t.rev):Promise.resolve()}).then(function(){return Promise.resolve(e)});return t.cb&&o(i,t.cb),i},a.prototype.getAttachment=function(){var e=this;return e._readDB.getAttachment.apply(e._readDB,arguments)},a.prototype.removeAttachment=function(){var e,r=this,t=n(arguments),i=r._remoteDB.removeAttachment.apply(r._remoteDB,t.args).then(function(t){return e=t,r._active?r._listener.waitForChange(t.rev):Promise.resolve()}).then(function(){return Promise.resolve(e)});return t.cb&&o(i,t.cb),i},a.prototype.query=function(){var e=this;return e._readDB.query.apply(e._readDB,arguments)},a.prototype.info=function(){var e=this,r=n(arguments),t={},i=Promise.all([e._remoteDB.info.apply(e._remoteDB,r.args),e._localDB.info.apply(e._localDB,r.args)]).then(function(e){return t.remote=e[0],t.local=e[1],Promise.resolve(t)});return r.cb&&o(i,r.cb),i},a.prototype.replicate={to:function(){this._localDB.replicate.to.apply(this._localDB,arguments)},from:function(){this._localDB.replicate.from.apply(this._localDB,arguments)}},"object"==typeof window&&(window.PouchMirror=a)},{"./backoff":1,"./listener":3}],3:[function(e,r,t){"use strict";var n=e("./utils"),o=n.defer,i=n.timeout,c=4900;r.exports=function(e){function r(e){a[e]=new Date;for(var r in a)a[r]+c<new Date&&delete a[r]}function t(e){var r=o();return i(r.promise,c)["catch"](Promise.TimeoutError,function(r){return delete n[e],Promise.reject(r)}),a[e]?(r.resolve({rev:e}),delete a[e]):n[e]=r,r.promise}var n={},a={},u=e.changes({since:"now",live:!0}).on("change",function(e){e.changes.forEach(function(e){"undefined"!=typeof n[e.rev]?(n[e.rev].resolve({rev:e.rev}),delete n[e.rev]):r(e.rev)})});return{waitForChange:t,cancel:function(){return u.cancel()}}}},{"./utils":4}],4:[function(e,r,t){"use strict";t.defer=function(){var e,r,t=new Promise(function(){e=arguments[0],r=arguments[1]});return{resolve:e,reject:r,promise:t}},t.timeout=function(e,r){var t,n=new Promise(function(e){var n=setTimeout(e,r);t=function(){clearTimeout(n),e(!0)}});return Promise.race([e.then(function(){t()}),n.then(function(e){if(!e)throw new Error("Operation timed out")})])}},{}]},{},[2]);